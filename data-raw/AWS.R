## code to prepare `AWS` dataset goes here
config <- config::get(file = "inst/app/data/config.yml")
pool <- pool::dbPool(
  drv = RMariaDB::MariaDB(),
  dbname = config$database,
  host = config$server,
  username = config$uid,
  password = config$pwd,
  port = config$port
)

DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_eventos (
  idEvento INT AUTO_INCREMENT PRIMARY KEY,
  idGira INT,
  nombre VARCHAR(100),
  lugar VARCHAR(100),
  direccion VARCHAR(200),
  descripcion VARCHAR(500),
  contacto VARCHAR(100),
  telefono VARCHAR(20),
  correo VARCHAR(100),
  fechaEvento DATETIME,
  inicioEvento DATETIME,
  finEvento DATETIME,
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT
);" )

# DBI::dbRemoveTable(pool,"tElectoralTest_giras")
DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_giras (
  idGira INT AUTO_INCREMENT PRIMARY KEY,
  Responsable VARCHAR(100),
  Descripcion TEXT,
  LugarInicio VARCHAR(100),
  FechaInicio DATETIME,
  LugarFinal VARCHAR(100),
  FechaFinal DATETIME,
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT
);" )

DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_evaluacionEventos (
  idEvento INT,
  numEventos INT,
  visitasPrioritarias INT,
  incidentes INT,
  asistentes VARCHAR(50),
  duracion VARCHAR(50),
  actitud VARCHAR(50),
  actitudOtro VARCHAR(50),
  calidadTecno VARCHAR(50),
  expectativas INT,
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT
);" )
#DBI::dbRemoveTable(pool,"tElectoralTest_evaluacionEventos")

# tbl(pool,"tElectoralTest_eventos") %>% select(idGira) %>% filter(idGira == 1)
# sandbox -----------------------------------------------------------------


DBI::dbExecute(pool, "CREATE TABLE tElectoral_prueba_responsables (
  idResponsable INT AUTO_INCREMENT PRIMARY KEY,
  responsable TEXT,
  activa TINYINT,
  usElimina TEXT
);" )

# DBI::dbRemoveTable(pool,"tElectoral_prueba_lugares")
DBI::dbExecute(pool,"CREATE TABLE tElectoral_prueba_lugares (
  idLugar INT AUTO_INCREMENT PRIMARY KEY,
  lugar TEXT,
  activa TINYINT,
  usElimina TEXT
);")

DBI::dbExecute(pool,"CREATE TABLE tElectoral_prueba_giras (
  idGira INT AUTO_INCREMENT PRIMARY KEY,
  idResponsable INT,
  idLugarInicio INT,
  idLugarFin INT,
  fechaInicio DATETIME,
  fechaFIN DATETIME,
  descripcion TEXT,
  activa TINYINT,
  usElimina TEXT
);")

DBI::dbExecute(pool,"CREATE TABLE tElectoral_prueba_eventos (
  idEvento INT AUTO_INCREMENT PRIMARY KEY,
  idGira INT,
  idLugar INT,
  idResponsable INT,
  fechaInicio DATETIME,
  fechaFIN DATETIME,
  descripcion TEXT,
  activa TINYINT,
  usElimina TEXT
);")

## Investigacion
#Candidatos y Colores Oficiales

DBI::dbExecute(pool, "CREATE TABLE IF NOT EXISTS tElectoralTest_partidoCandidato (
  idPartido INTEGER UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  nombrePartido VARCHAR(50) NOT NULL,
  nombreCandidato VARCHAR(50) NOT NULL  
  );")

DBI::dbExecute(pool, "INSERT INTO `tElectoralTest_partidoCandidato` VALUES (1, 'MORENA', 'AMLO'),
(2, 'PAN', 'ANAYA'),
(3, 'PRI', 'MEADE'),
(4, 'INDEPENDIENTE 1', 'MARGARITA'),
(5, 'INDEPENDIENTE 2', 'BRONCO');")
# (4, 'MORENA', 'Angel'),
# (5, 'PT', 'Gerardo'),
# (6, 'PVEM', 'Emilio'),
# (7, 'MC', 'Jesús'),
# (8, 'PES', 'Esteban'),
# (9, 'INDEPENDIENTE', 'Oscar');")
# DBI::dbExecute(pool, "INSERT INTO `tElectoralTest_partidoCandidato` VALUES (10, 'No sabe', 'No sabe'),
# (11, 'No contestó', 'No contestó');")
# tbl(pool,"tElectoralTest_partidoCandidato") %>% collect()
DBI::dbRemoveTable(pool, "tElectoralTest_partidoCandidato")


DBI::dbExecute(pool, "CREATE TABLE IF NOT EXISTS tElectoralTest_coloresOficiales(
  idColor INTEGER UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  idPartido INTEGER UNSIGNED NOT NULL REFERENCES partidoCandidato(idPartido),
  colorHex VARCHAR(50),
  colorRgb VARCHAR(50),
  opacity VARCHAR(50)
);")

# DBI::dbExecute(pool, "INSERT INTO `tElectoralTest_coloresOficiales` VALUES (1, 1,'#EB0E0E','rgb(235, 14, 14)',''),
# (2, 2,'#17418A','rgb(23, 65, 138)',''),
# (3, 3,'#FAB855','rgb(250, 184, 85)',''),
# (4, 4,'#751438','rgb(117, 20, 56)',''),
# (5, 5,'#D63131','rgb(214, 49, 49)',''),
# (6, 6,'#199121','rgb(25, 145, 33)',''),
# (7, 7,'#ED6B40','rgb(237, 107, 64)',''),
# (8, 8,'#54218A','rgb(84, 33, 138)',''),
# (9, 9,'#AD9B9A','rgb(173, 155, 154)','');")
#tbl(pool,"tElectoralTest_coloresOficiales") %>% collect()
# DBI::dbExecute(pool, "INSERT INTO `tElectoralTest_coloresOficiales` VALUES 
# (10, 10, '#404040', 'rgb(64,64,64)', ''),
# (11, 10, '#000000','rgb(0,0,0)', '');")
#DBI::dbRemoveTable(pool,"tElectoralTest_coloresOficiales")

# DBI::dbGetQuery(pool,"SELECT p.idPartido, p.nombrePartido, p.nombreCandidato, c.colorHex
#                       FROM tElectoralTest_partidoCandidato as p
#                       JOIN tElectoralTest_coloresOficiales c
#                       ON p.idPartido = c.idPartido;")

DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_investigacion_formularioGeneral (
  idFormGeneral INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100),
  casaEncuestadora VARCHAR(150),
  poblacionObjetivo VARCHAR(175),
  fechaInicio DATETIME,
  fechaFin DATETIME,
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT
);" )

# DBI::dbExecute(pool, glue::glue("INSERT INTO `tElectoralTest_investigacion_formularioGeneral` VALUES
#  (1, 'SDP Noticias', 'SDP Noticias', 'Nacional', '2020-03-26', '2020-03-31','{lubridate::now()}','NA','admin','NA','');"))
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_formularioGeneral")

#DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_cuestionario")
DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_investigacion_cuestionario (
  idCuestionario INT AUTO_INCREMENT PRIMARY KEY,
  idFormGeneral INT,
  urlArchivo VARCHAR(300),
  nivelClaridad VARCHAR(50),
  obsNivelClaridad VARCHAR(300),
  operacionalizacion VARCHAR(50),
  obsOperacionalizacion VARCHAR(300),
  poblacionObjetivo VARCHAR(50),
  obsPoblacionObjetivo VARCHAR(300),
  cantidadBloques INT,
  obsGenerales VARCHAR(300),
  correo VARCHAR(100),
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT,
  CONSTRAINT FK_cuestionario_FormGeneral FOREIGN KEY (idFormGeneral) REFERENCES tElectoralTest_investigacion_formularioGeneral(idFormGeneral)
);" )

# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_cuestionario_preguntasXBloque")
DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_investigacion_cuestionario_preguntasXBloque (
  idPreguntaXBloque INT AUTO_INCREMENT PRIMARY KEY,
  idCuestionario INT,
  nombre VARCHAR(100),
  numTotalPreguntasBloque INT,
  numDeseabilidadSocial INT,
  obsDeseabilidadSocial VARCHAR(300),
  numSupuestosImplicitos INT,
  obsSupuestosImplicitos VARCHAR(300),
  numDobleBarril INT,
  obsDobleBarril VARCHAR(300),
  numSinBalanceRedaccion INT,
  obsSinBalanceRedaccion VARCHAR(300),
  numNoMutuamenteExcluyentes INT,
  obsNoMutuamenteExcluyentes VARCHAR(300),
  numRespuestaSinEquilibrio INT,
  obsRespuestaSinEquilibrio VARCHAR(300),
  numDiezOpciones INT,
  obsDiezOpciones VARCHAR(300),
  numCategoriaNeutral INT,
  obsCategoriaNeutral VARCHAR(300),
  CONSTRAINT FK_preguntaxbloque_cuestionario FOREIGN KEY (idCuestionario) REFERENCES tElectoralTest_investigacion_cuestionario(idCuestionario)
);" )


DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_investigacion_intencionVoto (
  idIntencionVoto INT AUTO_INCREMENT PRIMARY KEY,
  idFormGeneral INT NOT NULL,
  tipoIntencionVoto VARCHAR(25),
  fechaEncuesta DATETIME, 
  pregunta VARCHAR(250),
  siNoExplicacion VARCHAR(250),
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT,
  CONSTRAINT FK_intencionVoto_FormGeneral FOREIGN KEY (idFormGeneral) REFERENCES tElectoralTest_investigacion_formularioGeneral(idFormGeneral)
);" )
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_intencionVoto")

DBI::dbExecute(pool, "CREATE TABLE IF NOT EXISTS tElectoralTest_investigacion_intencionVotoRegistro (
  idIntencionVotoRegistro INT AUTO_INCREMENT PRIMARY KEY,
  idIntencionVoto INT NOT NULL,
  candidato VARCHAR(25),
  partido VARCHAR(250),
  resultado VARCHAR(250),
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT,
  CONSTRAINT FK_intencionVotoRegistro_intencionVoto FOREIGN KEY (idIntencionVoto) REFERENCES tElectoralTest_investigacion_intencionVoto(idIntencionVoto)
);")
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_intencionVotoRegistro")

# DBI::dbExecute(pool, "CREATE TABLE IF NOT EXISTS tElectoralTest_MarcoMuestral (
#   idMarco INTEGER UNSIGNED PRIMARY KEY AUTO_INCREMENT,
#   nombreMarco VARCHAR(50) NOT NULL );")
# 
# DBI::dbExecute(pool, "INSERT INTO `tElectoralTest_MarcoMuestral` VALUES
#  (1, 'manzana'),
#  (2, 'sección'),
#  (3,  'distrito local'),
#  (4, 'distrito federal'),
#  (5, 'estado');")
# tbl(pool,"tElectoralTest_MarcoMuestral") %>% collect()
# DBI::dbRemoveTable(pool, "partidoCandidato")

DBI::dbExecute(pool, "CREATE TABLE tElectoralTest_investigacion_disenoMuestral (
  idDMuestral INT AUTO_INCREMENT PRIMARY KEY,
  idFormGeneral INT NOT NULL,
  modoLevantamiento VARCHAR(50),
  marcoMuestral VARCHAR(150),
  numeroEntrevistas INT,
  aleatoria VARCHAR(10),
  poliEtapa VARCHAR(10),
  nivelpoliEtapa INT NULL,
  estratificada VARCHAR(10),
  nivielEstratificada INT NULL,
  conglomerados VARCHAR(10),
  nivielConglomerados INT NULL,
  unidadMuestral VARCHAR(200),
  nivelConfianza INTEGER UNSIGNED,
  margenError INTEGER UNSIGNED,
  observaciones VARCHAR(500) NULL,
  fechaAlta DATETIME,
  fechaEdicion DATETIME,
  usuarioCrea VARCHAR(100),
  usuarioEdicion VARCHAR(100),
  activo TINYINT,
  CONSTRAINT FK_DisMuestral_FormGeneral FOREIGN KEY (idFormGeneral) REFERENCES tElectoralTest_investigacion_formularioGeneral(idFormGeneral)
);")


# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_disenoMuestral")

# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_disenoMuestral")
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_intencionVotoRegistro")
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_intencionVoto")
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_cuestionario_preguntasXBloque")
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_cuestionario")
# DBI::dbRemoveTable(pool,"tElectoralTest_investigacion_formularioGeneral")
# usethis::use_data(AWS, overwrite = TRUE)
